---
layout:     post
title:      初始机器人操作系统ROS
subtitle:   Robot Operating System
date:       2019-09-17
author:     Lij
header-img: img/post-bg-coffee.jpeg
catalog: true
tags:
    - ros
    - 机器人
---

### 一、ROS简介

ROS 是一个适用于机器人的开源的元操作系统。它提供了操作系统应有的服务，包括硬件抽象，底层设备控制，常用函数的实现，进程间消息传递，以及包管理。它也提供用于获取、编译、编写、和跨计算机运行代码所需的工具和库函数。在某些方面ROS相当于一种“机器人框架（robot frameworks）”类似的“机器人框架”有：Player，YARP，Orocos，CARMEN，Orca，MOOS和 Microsoft Robotics Studio。

ROS 运行时的“蓝图”是一种基于ROS通信基础结构的松耦合点对点进程网络。ROS实现了几种不同的通信方式，包括基于同步RPC样式通信的服务（services）机制，基于异步流媒体数据的话题（topics）机制以及用于数据存储的参数服务器（Parameter Server）。

ROS并不是一个实时的框架，但ROS可以嵌入实时程序。Willow Garage的PR2机器人使用了一种叫做pr2_etherCAT的系统来实时发送或接收ROS消息。ROS也可以与Orocos实时工具包无缝集成。

### 目的
很多人都在问“ROS与其它机器人软件平台有什么不同？”这是一个很难解答的问题。因为ROS不是一个集成了大多数功能或特征的框架。事实上，ROS 的主要目标是为机器人研究和开发提供代码复用的支持。ROS是一个分布式的进程（也就是节点）框架，这些进程被封装在易于被分享和发布的程序包和功能包集中。ROS也支持一种类似于代码储存库的联合系统，这个系统也可以实现工程的协作及发布。这个设计可以使一个工程的开发和实现从文件系统到用户接口完全独立决策（不受ROS限制）。同时，所有的工程都可以被ROS的基础工具整合在一起。

为了支持分享和协作的主要目的，ROS框架也有其它几个目标：

- 小型化：ROS尽可能设计的很小 -- 我们不封装您的 main() 函数 -- 所以为ROS编写的代码可以轻松的在其它机器人软件平台上使用。 由此得出的必然结论是ROS可以轻松集成在其它机器人软件平台：ROS已经可以与OpenRAVE，Orocos和Player集成。
ROS不敏感库：ROS的首选开发模型都是用不依赖ROS的干净的库函数编写而成。
语言独立：ROS框架可以简单地使用任何的现代编程语言实现。我们已经实现了Python版本，C++版本和 Lisp版本。同时，我们也拥有Java 和 Lua版本的实验库。

- 方便测试：ROS内建一个了叫做rostest的单元/集成测试框架，可以轻松安装或卸载测试模块。

- 可扩展：ROS可以适用于大型运行时系统和大型开发进程。

所以，“ROS与其它机器人软件平台有什么不同？”很难得到一个适用于所有情况的答案，但是，如果你选择使用其它机器人软件平台，我们希望你仍然可以使用到很多基于ROS发布的库函数。至于更多细节，这封Brian Gerkey（同时涉猎 Player 和 ROS）向ROS用户所写的关于ROS和Player区别的电子邮件（包括OpenCV 的集成）可以为我们提供一些比较：

    这个问题的答案，和许多问题一样，视情况而定。特别是取悦于你想要干什么。Player非常适合简洁的非铰接的移动平台。它的设计为那些激光雷达的先锋提供了简单的传感器和电机操作方法。
    
    然而，ROS是围绕着基于驱动传感器（倾斜式激光，盘式/斜试头部传感器，机械臂传感器）的复杂移动处理平台设计的。与Player相比，ROS可以更方便的借助分布式计算设备，而且我可以肯定，越高级的应用越适用于ROS而不是Player。换句话说，Player提供了更多的硬件驱动，而ROS提供了更多算法。
    
    我认为，说ROS比Player更加灵活强大是公平的。但是，现实情况是，更加灵活强大意味着更加复杂。尽管我们很努力的使ROS更加简单易用，ROS仍然需要一个很长的学习过程。当然，熟悉Player会对学习ROS有很大帮助，因为它们很多基本的方面都是相似的。
    
    关于你们针对OpenCV集成提出的问题，我想你们会发现ROS集成OpenCV的代码要比Player多一点。未来，当ROS和OpenCV团队明显重叠时，你们会发现这种差异将变得更大。
    
    我发现ROS利用了大量的来自于Player工程的代码。ROS节点的代码重用了许多Player的驱动，而且Stage和Gazebo可在ROS社区中得到广泛的支持和良好的应用。
    
### ROS主要特点：

1）点对点设计

一个使用ROS的系统包括一系列进程，这些进程存在于多个不同的主机并且在运行过程中通过端对端的拓扑结构进行联系，如图2所示。虽然基于中心服务器的那些软件框架也可以实现多进程和多主机的优势，但是在这些框架中，当各电脑通过不同的网络进行连接时，中心数据服务器就会发生问题。ROS的点对点设计以及服务和节点管理器等机制可以分散由计算机视觉和语音识别等功能带来的实时计算压力，能够适应多机器人遇到的挑战。

![](/img/ros/初始机器人操作系统ros-1.png)  

2）多语言支持

ROS现在支持许多种不同的语言，例如C++、Python、Octave和LISP，也包含其他语言的多种接口实现。

3）精简与集成

ROS建立的系统具有模块化的特点，各模块中的代码 可以单独编译，而且编译使用的CMake工具使它很容易的就实现精简的理念。ROS基本将复杂的代码封装在库里 ，只是创建了一些小的应用程序为ROS显示库的功能，就允许了对简单的代码超越原型进行移植和重新使用。 作为一种新加入的有优势，单元测试当代码在库中分散后也变得非常的容易，一个单独的测试程序可以测试库 中很多的特点。ROS利用了很多现在已经存在的开源项目的代码，比如说从Player项目中借鉴了驱动、运动 控制和仿真方面的代码，从OpenCV中借鉴了视觉算法方面的代码，从OpenRAVE借鉴了规划算法的内容，还有很 多其他的项目。在每一个实例中，ROS都用来显示多种多样的配置选项以及和各软件之间进行数据通信，也同 时对它们进行微小的包装和改动。ROS可以不断的从社区维护中进行升级，包括从其他的软件库、应用补丁中 升级ROS的源代码。

4）具有丰富的工具包，且免费开源。

### 如何学习ROS？

要想学ROS，应该从哪里入手，它的先后顺序是怎样的呢？ROS由四大部分构成，第一个是基础结构，这些通讯机制是如何实现的；第二个是工具，包括仿真工具、调试工具等；第三个是体现它功能的package；第四个就是社区，如何去上面下载、发布代码，和其他开发者交流学习。

### ROS-设计思想：分布式架构
设计思想主要是分布式架构，将机器人的功能和软件，做成一个个节点，然后每个节点通过topic进行沟通，但你这些节点可以部署在同一台机器上，也可以部署在不同机器上，还可以部署在互联网上。

### ROS-核心概念

ROS核心概念如下：

1）Nodes->节点

节点是各自独立的可执行文件，能够通过话题、服务或参数，与服务器或其他进程(节点)通信。ROS通过使用节点的方式将代码和功能解耦，提高了系统容错能力和可维护性，使系统简化。同时，节点允许了ROS系统能够布置在任意多个机器上并同时运行。关于节点需要注意的事项，节点在系统中必须有唯一的名称；节点可以使用不同的库进行编写，如roscpp和rospy，其中roscpp基于C++，rospy基于Python。

2）Messages and Topics->消息与话题（或主题）

节点之间通过topic机制进行通信，topic机制是一个一对多的Publish/Subscribe 模式: 同一个话题也可以有很多个订阅者，它的底层传输依靠的是TCP/IP，也可以是UDP。topic具体传输的message，具有一定的类型和数据结构，包括ROS提供的标准类型，和用户自定义类型。

3）Services and Parameters->服务与参数

除了topic，ROS还提供另一种一对一的机制，也就是Service/Client，当你需要直接与节点通信并获得应答时，将无法通过话题实现，这时需要使用该服务。

4）ROS Master->ROS管理器

Master向ROS系统中其他节点提供命名和注册服务，跟踪和记录话题的发布者和订阅者，使ROS 节点之间能够相互查找。一旦节点找到了彼此，就能建立一种点对点的通信方式。

5）Stacks and packages->堆栈与功能包

那么如何组织代码呢？这主要依靠功能包(Package) ，ROS中软件组织的基本形式，用于创建ROS程序。功能包包含源代码和功能包清单(Manifest) 。功能包清单提供关于功能包、许可信息、依赖关系、编译标志等的信息。功能包清单是一个manifests.xml文件，通过这个文件能够实现对功能包的管理。

### ROS-核心模块
ROS核心模块包括通信结构基础、机器人特性功能以及工具集。通信结构基础包括消息传递、记录和回放消息、远程过程调用、分布式参数系统；机器人特性功能包括标准机器人消息，机器人几何库，机器人描述语言，抢占式远程过程调用，诊断，位置估计、定位与导航；工具集包括命令式工具、可视化工具以及图形化接口。详情见图

![](/img/ros/初始机器人操作系统ros-2.png)  


### ROS-核心工具

ROS拥有很多第三方的核心工具的支持，或者说Package。比较常见的是这五个工具：Gazebo是一个三维仿真环境；OpenCV是计算机视觉库，PCL是点云库，MoveIt！是机械臂的规划控制库，Industrial是工业上会用的库。另外MRPT，是一个非常好的机器人编程工具箱。然后，如果对实时控制要求比较高的话，可以考虑The Orocos Project。

ROS常用命令工具包括rostopic (Topics)、rosservice (Services)、rosnode (Nodes)、rosparam (Parameters)、rosmsg (Messages)、rossrv (Services)和roswtf (General debugging)。

ROS用的最多的可视化工具是rqt（集成图像交互界面）和 rviz（3D 可视化工具）。

ROS具有非常强的数据存储/回放功能，也就是使用bag存储topic(例如现实中的传感器数据)，以后调用bag的topic数据则不必每次都在现实中运行机器人，速度非常快。

ROS log系统记录软件运行相关信息，便于以后的调试。

仿真环境由易到难主要有这三个：Turtlesim、ArbotiX、Gazebo。Turtlesim是一个QT开发的2D轨迹显示界面，只能显示运动轨迹；ArbotiX是含有一个差速驱动机器人的rviz模拟器，机器人运动及topic数据的3D显示，但不包含物理学引擎；Gazebo是功能齐全的3D物理模拟器，不过缺点是非常重，对内存和显卡要求高，慎入


### 参考

[机器人操作系统ROS(一)-初识](https://www.jianshu.com/p/0869eec39a3b)

[ROS中文官网](http://wiki.ros.org/cn/ROS/Introduction)